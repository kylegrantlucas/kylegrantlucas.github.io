---
import Layout from "../layouts/Layout.astro";
import Icon from "../components/Icon.astro";
import { getResumeData } from "../utils/resume.js";

// Fetch resume data
const resume = await getResumeData();

// Get 2 most recent previous companies, deduplicated by name
const currentCompany = resume.work[0].name;
const previousCompanies = resume.work
    .filter((job) => job.name !== currentCompany)
    .filter((job, i, arr) => arr.findIndex((j) => j.name === job.name) === i)
    .slice(0, 2);
---

<Layout>
    <h1>Hi, I'm {resume.basics.name}. ðŸ‘‹</h1>

    <h2>About</h2>

    <p>
        I'm a <strong>{resume.work[0].position}</strong>, working on web security and distributed systems.
    </p>

    <p>
        Currently I work at <a href={resume.work[0].url}>{resume.work[0].name}</a>, building edge security infrastructure.
    </p>

    <p>
        Previously I have worked at {
            previousCompanies.map((company, i) => (
                <span>
                    {i > 0 && " and "}
                    <a href={company.url}>{company.name}</a>
                </span>
            ))
        }.</p>

    <h2>Connect</h2>

    <p>
        You can find me elsewhere on the internet:
        {
            resume.basics.profiles
                .slice()
                .reverse()
                .map((profile, index) => (
                    <span>
                        <a href={profile.url}>
                            <Icon name={profile.network.toLowerCase()} />{" "}
                            {profile.network}
                        </a>
                        {index < resume.basics.profiles.length - 1 ? ", " : ""}
                    </span>
                ))
        }
        .
    </p>

    <p>
        <strong>Contact:</strong>
        <a href={`mailto:${resume.basics.email}`}
            ><Icon name="paper-plane" />
            {resume.basics.email}</a
        >
    </p>
</Layout>
